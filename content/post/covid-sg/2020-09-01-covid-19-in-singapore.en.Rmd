---
title: A Short Story of COVID-19 in Singapore
author: Brendi Ang
date: '2020-09-01'
slug: covid-19-in-singapore
categories:
  - R
tags:
  - R Markdown
  - Academic
subtitle: ''
summary: ''
authors: []
lastmod: '2020-09-01T22:09:55+10:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
bibliography: [references.bib]
link-citations: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load library
library(tidyverse)
library(coronavirus) # devtools::install_github("RamiKrispin/coronavirus")
library(gganimate)
library(janitor)
library(lubridate)
library(tidycovid19) # remotes::install_github("joachim-gassen/tidycovid19")
library(transformr)
library(readxl)
library(timevis)
```

The Covid-19 pandemic has altered people's lives, be it enormous or minute. Undoubtedly, there will be many stories told of how they 'survived' this pandemic down the road, fighting for toilet papers and masks and how bumping elbows were the norm etc. As a student, I'd like to add that group assignments studying online is a chore when you can't have face-to-face conversations. 

My first blog post is a short story of the COVID-19 situation in my home country, Singapore.

## Data Description 

`coronavirus` depicts details of coronavirus cases for all countries from 22-01-2020. It is in a long format where each observation represents a detailed summary of COVID-19 cases by country. I've chosen to use this data set in conjunction with the `merged_df` data set the data is in a long format and will be handy when plotting and constructing tables.

```{r read-in-data}
# From coronavirus package: long format of covid cases
sg_long <- coronavirus %>% 
  filter(country == "Singapore") %>%
  select(-province) # No province in Singapore

# Load data for all countries
merged_df <- download_merged_data(cached = TRUE, silent = TRUE) 

sg_df <- merged_df %>%
  filter(country == "Singapore")
```

```{r read-gdp, include = FALSE}
# read-in GDP data
sg_gdp <- read_excel("OutputFile.xlsx")

sg_gdp <- sg_gdp %>%
  filter(!is.na(Variables)) %>%
  slice(1:(n()- 3))  # Remove last 3 rows relating to contact info

# Transpose data
sg_gdp <- as.data.frame(t(as.matrix(sg_gdp))) 

colnames(sg_gdp) <- sg_gdp[1,] 

sg_gdp <- sg_gdp %>% #
  slice(-1)

# Add Year variable& tidy data set 
sg_gdp <- sg_gdp %>%
  rownames_to_column('Year') %>%
  janitor::clean_names() # Remove spacings in variable names
```

In this blog, three main data sets will be used.


## A Timeline of for Covid-19 in Singapore

```{r, outwidth = 12}
time_vis <- tribble (~id, ~content, ~start, ~end,
      1, "First Case detected, man from Overseas", "2020-01-23", NA, 
      2, "First local case", "2020-02-04", NA, 
      3, "Dorscon level changed (yellow to orange), wave of panic buyers ensued", "2020-02-07", NA, 
      4, "First death from the virus", "2020-03-21", NA, 
      5, "Bars, cinemas and entertainment outlet closes", "2020-03-26", NA,
      6, "Commencement of first lockdown", "2020-04-07", "2020-06-01",
      7, "Mandatory mask wearing", "2020-04-14", NA,
      8, "Changi Airport Terminal 2 suspends operations for 18 months", "2020-04-30", NA,
      9, "End of first lockdown, school reopens", "2020-06-01", NA,
      10, "Singapore General Election held", "2020-07-10", NA)
 
timevis(time_vis)
```


### Animation for covid cases

```{r sg-phases}
# Duration of each government intervention 
sg_long <- sg_long %>%
  mutate(phase =
           case_when(
          between(date, as.Date("2020-01-22"), as.Date("2020-04-06")) ~ "No lockdown",
          between(date, as.Date("2020-04-07"), as.Date("2020-06-01")) ~ "First Lockdown",
          between(date, as.Date("2020-06-02"), as.Date("2020-06-17")) ~ "Phase 1 (Safe Reopening)",
          between(date, as.Date("2020-06-18"), as.Date("2020-09-01")) ~ "Phase 2 (Safe Transition)")
         )

# Start and end date for each government intervention
lockdown_dur <- sg_long %>% 
  group_by(phase) %>%
  summarise(start = min(date),
            end = max(date))

# Cumulative sum of each case type
sg_long <- sg_long %>%
  group_by(type) %>%
  mutate(cases_cum = cumsum(cases))
```

```{r static-cases}
# Plot cases in a static plot
p1 <- ggplot(sg_long) +
  # plot covid cases
  geom_line(aes(x = date,
                y = cases,
                colour = type),
            alpha = 0.8) +
  theme_bw() +
  scale_colour_manual(values = c("#bc3a3a", "#00468b" ,"#468b00")) +
  theme(legend.position = "bottom") +
  scale_x_date(date_breaks = "1 week", 
               date_labels = "%b %d") +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
        panel.grid.minor.x = element_blank()) +
  ggtitle("Number of confirmed, death and recovered COVID-19 Cases") +
  # Colour each phase of government intervention 
  geom_rect(data = lockdown_dur,
            aes(xmin = start, 
                xmax = end,
                ymin = -Inf, 
                ymax = Inf,
                fill = phase),
            alpha = 0.15)

# Cumulative sum
p2 <- ggplot(sg_long) +
  # plot covid cases
  geom_line(aes(x = date,
                y = cases_cum,
                colour = type),
            alpha = 0.8) +
  theme_bw() +
  scale_colour_manual(values = c("#bc3a3a", "#00468b" ,"#468b00")) +
  theme(legend.position = "bottom") +
  scale_x_date(date_breaks = "1 week", 
               date_labels = "%b %d") +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
        panel.grid.minor.x = element_blank()) +
  ggtitle("Number of confirmed, death and recovered COVID-19 Cases") +
  # Colour each phase of government intervention 
  geom_rect(data = lockdown_dur,
            aes(xmin = start, 
                xmax = end,
                ymin = -Inf, 
                ymax = Inf,
                fill = phase),
            alpha = 0.15)
```

```{r animate-cases}
p1 + transition_reveal(date) 

# p2 + transition_reveal(date) 
```

Why so little death? Is it attributed to great hospital equipment? Were there times when hospitals were over capacity?

*Key Observations*  
- People recover in about 2 weeks
- Very low death rates, almost 0 


## Interactive table (with data story)





## tables with numerical summary


\clearpage

# References



